{% load static %}
<div :class="{ 'dark text-white-dark': $store.app.semidark }">
  <nav
    x-data="{
      activeDropdown: null,
      current: window.location.pathname,
      handleKeys(e){ if(e.shiftKey && (e.key==='N' || e.key==='n')) { window.location.href='/campaigns/new' } }
    }"
    @keydown.window="handleKeys"
    class="sidebar fixed min-h-screen h-full top-0 bottom-0 w-[260px] shadow-[5px_0_25px_0_rgba(94,92,154,0.1)] z-50 transition-all duration-300"
    aria-label="User navigation" 
  >
    <div class="bg-white dark:bg-[#0e1726] h-full flex flex-col">
      <!-- Brand + collapse -->
      <div class="flex items-center justify-between px-4 py-3 border-b border-[#ebedf2] dark:border-[#191e3a]">
        <a href="/dashboard" class="main-logo flex items-center shrink-0">
          <img class="w-8 ml-[5px] flex-none" src="{% static 'assets/images/logo.svg' %}" alt="ECS" />
          <span class="text-2xl ltr:ml-1.5 rtl:mr-1.5 font-semibold align-middle lg:inline dark:text-white-light">ECS</span>
        </a>
        <button type="button" class="collapse-icon w-8 h-8 rounded-full flex items-center hover:bg-gray-500/10 dark:hover:bg-dark-light/10 dark:text-white-light transition duration-300 rtl:rotate-180" @click="$store.app.toggleSidebar()" aria-label="Collapse sidebar">
          <svg class="w-5 h-5 m-auto" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13 19L7 12L13 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path opacity="0.5" d="M17 19L11 12L17 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
      </div>

      <!-- NAV: User-only IA -->
      <ul class="perfect-scrollbar font-semibold space-y-0.5 overflow-y-auto overflow-x-hidden px-3 pt-3 pb-24 flex-1">
        <!-- Section: Overview -->
        <li class="px-2 py-1 text-xs tracking-wider uppercase text-[#7b8aa0] dark:text-white-dark/60">Overview</li>
        <!-- Dashboard -->
        <li class="menu nav-item">
          <a href="/dashboard" class="nav-link group rounded-lg px-3 py-2 transition"
             :class="{ 'active !bg-primary/10 !text-primary ring-1 ring-primary/20': current.startsWith('/dashboard') }">
            <div class="flex items-center">
              <svg class="group-hover:!text-primary" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity="0.5" d="M2 12.2C2 9.9 2 8.8 2.52 7.82C3.04 6.87 3.99 6.29 5.88 5.11L7.88 3.87C9.89 2.62 10.89 2 12 2C13.11 2 14.11 2.62 16.12 3.87L18.12 5.11C20.01 6.29 20.96 6.87 21.48 7.82C22 8.77 22 9.92 22 12.2V13.73C22 17.63 22 19.58 20.83 20.79C19.66 22 17.77 22 14 22H10C6.23 22 4.34 22 3.17 20.79C2 19.58 2 17.63 2 13.73V12.2Z" fill="currentColor"/><path d="M9 17.25C8.586 17.25 8.25 17.586 8.25 18C8.25 18.414 8.586 18.75 9 18.75H15C15.414 18.75 15.75 18.414 15.75 18C15.75 17.586 15.414 17.25 15 17.25H9Z" fill="currentColor"/></svg>
              <span class="ltr:pl-3 rtl:pr-3 text-black dark:text-[#bfc9d4] group-[.active]:text-primary">My Dashboard</span>
            </div>
          </a>
        </li>

        <!-- Section: Campaigns -->
        <li class="px-2 pt-5 pb-1 text-xs tracking-wider uppercase text-[#7b8aa0] dark:text-white-dark/60">Campaigns</li>
        <!-- Campaigns -->
        <li class="menu nav-item">
          <button type="button" class="nav-link group w-full rounded-lg px-3 py-2 transition flex items-center justify-between"
                  :class="{ 'active !bg-primary/10 !text-primary ring-1 ring-primary/20': activeDropdown==='campaigns' || current.startsWith('/campaigns') }"
                  @click="activeDropdown === 'campaigns' ? activeDropdown = null : activeDropdown = 'campaigns'">
            <div class="flex items-center">
              <svg class="group-hover:!text-primary" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.404 22.48l.275-.465c.44-.745.66-1.117 1.011-1.325.351-.207.809-.222 1.725-.251.859-.028 1.436-.103 1.93-.307 1.039-.43 1.865-1.256 2.295-2.295.323-.78.323-1.768.323-3.744V13.245c0-2.777 0-4.165-.625-5.185a4 4 0 0 0-1.4-1.4c-1.02-.625-2.408-.625-5.185-.625H8.21c-2.777 0-4.165 0-5.185.625a4 4 0 0 0-1.4 1.4C1 9.08 1 10.468 1 13.245v.848c0 1.976 0 2.964.323 3.744.43 1.039 1.256 1.865 2.295 2.295.494.204 1.071.279 1.93.307.916.03 1.374.044 1.725.251.351.208.571.58 1.012 1.325l.275.465c.41.692 1.434.692 1.844 0ZM13.193 14.517a1.06 1.06 0 1 0 0-2.122 1.06 1.06 0 0 0 0 2.122Zm-2.651-1.06a1.06 1.06 0 1 1-2.122 0 1.06 1.06 0 0 1 2.122 0Zm-3.71 1.06a1.06 1.06 0 1 0 0-2.121 1.06 1.06 0 0 0 0 2.122Z" fill="currentColor"/><path opacity="0.5" d="M15.486 1c1.267 0 2.274 0 3.082.077.828.079 1.528.244 2.152.626A5.5 5.5 0 0 1 22.296 3.28c.383.624.548 1.324.626 2.153C23 6.24 23 7.247 23 8.513v.866c0 .901 0 1.619-.04 2.2-.04.595-.124 1.106-.322 1.584a3.5 3.5 0 0 1-2.582 2.236h-1.65c.017-.499.017-1.093.017-1.822v-.848c0-2.777 0-4.164-.625-5.185a4 4 0 0 0-1.4-1.4c-1.02-.624-2.408-.624-5.184-.624H5.732V4.413c.033-.113.078-.243.13-.395.089-.259.203-.504.346-.738.394-.642.933-1.182 1.575-1.575.624-.383 1.324-.548 2.153-.626C10.744 1 11.751 1 13.018 1h2.468Z" fill="currentColor"/></svg>
              <span class="ltr:pl-3 rtl:pr-3 text-black dark:text-[#bfc9d4] group-[.active]:text-primary">Campaigns</span>
            </div>
            <div class="rtl:rotate-180 transition" :class="{ '!rotate-90': activeDropdown === 'campaigns' }"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 5L15 12L9 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
          </button>
          <ul x-cloak x-show="activeDropdown === 'campaigns' || current.startsWith('/campaigns')" x-collapse class="sub-menu text-gray-500">
            <li><a href="/campaigns">All</a></li>
            <li><a href="/campaigns/new">New Campaign</a></li>
            <li><a href="/campaigns?status=scheduled">Scheduled</a></li>
            <li><a href="/campaigns?status=draft">Drafts</a></li>
            <li><a href="/campaigns?status=completed">Completed</a></li>
          </ul>
        </li>

        <!-- Audiences -->
        <li class="px-2 pt-5 pb-1 text-xs tracking-wider uppercase text-[#7b8aa0] dark:text-white-dark/60">Audiences</li>
        <li class="menu nav-item">
          <button type="button" class="nav-link group w-full rounded-lg px-3 py-2 transition flex items-center justify-between"
                  :class="{ 'active !bg-primary/10 !text-primary ring-1 ring-primary/20': activeDropdown==='audiences' || current.startsWith('/audiences') || current.startsWith('/contacts') || current.startsWith('/tags') }"
                  @click="activeDropdown === 'audiences' ? activeDropdown = null : activeDropdown = 'audiences'">
            <div class="flex items-center">
              <svg class="group-hover:!text-primary" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 11a5 5 0 1 1 10 0 5 5 0 0 1-10 0Z" stroke="currentColor" stroke-width="1.5"/><path d="M3 20c1.79-2.67 5.06-4 9-4s7.21 1.33 9 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
              <span class="ltr:pl-3 rtl:pr-3 text-black dark:text-[#bfc9d4] group-[.active]:text-primary">Audiences</span>
            </div>
            <div class="rtl:rotate-180 transition" :class="{ '!rotate-90': activeDropdown === 'audiences' }"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 5L15 12L9 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
          </button>
          <ul x-cloak x-show="activeDropdown === 'audiences' || current.startsWith('/audiences') || current.startsWith('/contacts') || current.startsWith('/tags')" x-collapse class="sub-menu text-gray-500">
            <li><a href="/audiences">All Audiences</a></li>
            <li><a href="/contacts">Contacts</a></li>
            <li><a href="/tags">Tags</a></li>
            <li><a href="/audiences/import">Import</a></li>
          </ul>
        </li>

        <!-- Templates -->
        <li class="px-2 pt-5 pb-1 text-xs tracking-wider uppercase text-[#7b8aa0] dark:text-white-dark/60">Templates</li>
        <li class="menu nav-item">
          <button type="button" class="nav-link group w-full rounded-lg px-3 py-2 transition flex items-center justify-between"
                  :class="{ 'active !bg-primary/10 !text-primary ring-1 ring-primary/20': activeDropdown==='templates' || current.startsWith('/templates') }"
                  @click="activeDropdown === 'templates' ? activeDropdown = null : activeDropdown = 'templates'">
            <div class="flex items-center">
              <svg class="group-hover:!text-primary" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 5h12M6 10h12M6 15h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
              <span class="ltr:pl-3 rtl:pr-3 text-black dark:text-[#bfc9d4] group-[.active]:text-primary">Templates</span>
            </div>
            <div class="rtl:rotate-180 transition" :class="{ '!rotate-90': activeDropdown === 'templates' }"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 5L15 12L9 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
          </button>
          <ul x-cloak x-show="activeDropdown === 'templates' || current.startsWith('/templates')" x-collapse class="sub-menu text-gray-500">
            <li><a href="/templates">All Templates</a></li>
            <li><a href="/templates/new">New Template</a></li>
          </ul>
        </li>

        <!-- Reports -->
        <li class="px-2 pt-5 pb-1 text-xs tracking-wider uppercase text-[#7b8aa0] dark:text-white-dark/60">Reports</li>
        <li class="menu nav-item">
          <button type="button" class="nav-link group w-full rounded-lg px-3 py-2 transition flex items-center justify-between"
                  :class="{ 'active !bg-primary/10 !text-primary ring-1 ring-primary/20': activeDropdown==='reports' || current.startsWith('/reports') }"
                  @click="activeDropdown === 'reports' ? activeDropdown = null : activeDropdown = 'reports'">
            <div class="flex items-center">
              <svg class="group-hover:!text-primary" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 7h16M7 13h10M9 17h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
              <span class="ltr:pl-3 rtl:pr-3 text-black dark:text-[#bfc9d4] group-[.active]:text-primary">Reports</span>
            </div>
            <div class="rtl:rotate-180 transition" :class="{ '!rotate-90': activeDropdown === 'reports' }"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 5L15 12L9 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
          </button>
          <ul x-cloak x-show="activeDropdown === 'reports' || current.startsWith('/reports')" x-collapse class="sub-menu text-gray-500">
            <li><a href="/reports">Overview</a></li>
            <li><a href="/reports/deliverability">Deliverability</a></li>
            <li><a href="/reports/links">Top Links</a></li>
          </ul>
        </li>

        <!-- Settings -->
        <li class="px-2 pt-5 pb-1 text-xs tracking-wider uppercase text-[#7b8aa0] dark:text-white-dark/60">Settings</li>
        <li class="menu nav-item">
          <button type="button" class="nav-link group w-full rounded-lg px-3 py-2 transition flex items-center justify-between"
                  :class="{ 'active !bg-primary/10 !text-primary ring-1 ring-primary/20': activeDropdown==='settings' || current.startsWith('/users') || current.startsWith('/senders') || current.startsWith('/domains') || current.startsWith('/api-keys') }"
                  @click="activeDropdown === 'settings' ? activeDropdown = null : activeDropdown = 'settings'">
            <div class="flex items-center">
              <svg class="group-hover:!text-primary" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 15a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z" stroke="currentColor" stroke-width="1.5"/><path d="M3 22c1.667-3.667 4.667-5.5 9-5.5s7.333 1.833 9 5.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
              <span class="ltr:pl-3 rtl:pr-3 text-black dark:text-[#bfc9d4] group-[.active]:text-primary">Settings</span>
            </div>
            <div class="rtl:rotate-180 transition" :class="{ '!rotate-90': activeDropdown === 'settings' }"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 5L15 12L9 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
          </button>
          <ul x-cloak x-show="activeDropdown === 'settings' || current.startsWith('/users') || current.startsWith('/senders') || current.startsWith('/domains') || current.startsWith('/api-keys')" x-collapse class="sub-menu text-gray-500">
            <li><a href="/users/profile">Profile</a></li>
            <li><a href="/senders">Senders</a></li>
            <li><a href="/domains">Domains</a></li>
            <li><a href="/api-keys">API Keys</a></li>
          </ul>
        </li>
      </ul>

      <!-- Sticky CTA: New Campaign -->
      <div class="sticky bottom-0 left-0 right-0 border-t border-[#ebedf2] dark:border-[#191e3a] p-3 bg-gradient-to-tr from-white to-white/95 dark:from-[#0e1726] dark:to-[#0e1726]/90">
        <a href="/campaigns/new" title="New Campaign (Shift+N)"
           class="block w-full rounded-xl text-white bg-gradient-to-r from-[#4361ee] to-[#160f6b] shadow-md hover:shadow-lg active:scale-[.99] transition px-4 py-3">
          <span class="flex items-center justify-center gap-2">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
            <span class="font-semibold tracking-wide">New Campaign</span>
            <span class="ml-auto text-xs bg-white/20 rounded px-2 py-0.5">Shift + N</span>
          </span>
        </a>
        <div class="mt-2 text-[11px] text-[#7b8aa0] dark:text-white-dark/60 text-center">
          Start from a <a href="/templates" class="text-primary hover:underline">template</a> or <a href="/audiences/import" class="text-primary hover:underline">import contacts</a>
        </div>
      </div>
    </div>
  </nav>
</div>