{% extends 'components/layouts/default.html' %}
{% load static %}

{% block content %}

<div x-data="campaigns">
    <div class="flex items-center justify-between flex-wrap gap-4">
        <h2 class="text-xl">Campaigns</h2>
    </div>
    <template x-teleport="body">
                        <div class="fixed inset-0 bg-[black]/60 z-[999] overflow-y-auto hidden" :class="addCampaignModal && '!block'">
                            <div class="flex items-center justify-center min-h-screen px-4" @click.self="addCampaignModal = false">
                                <div x-show="addCampaignModal" x-transition x-transition.duration.300 class="panel border-0 p-0 rounded-lg overflow-hidden md:w-full max-w-lg w-[90%] my-8">
                                    <button type="button" class="absolute top-4 ltr:right-4 rtl:left-4 text-white-dark hover:text-dark" @click="addCampaignModal = false">

                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
                                            <line x1="18" y1="6" x2="6" y2="18"></line>
                                            <line x1="6" y1="6" x2="18" y2="18"></line>
                                        </svg>
                                    </button>
                                    <h3 class="text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]" x-text="params.id ? 'Edit Campaign' : 'New Campaign'"></h3>
                                    <div class="p-5 pt-3 pb-0">
                                        <!-- Campaign Form -->
                                        <form @submit.prevent="saveUser" x-data="{ emailError:false }"
                                            class="bg-white rounded-2xl shadow-xl ring-1 ring-black/5 p-6 sm:p-8 space-y-6 pt-0">
                                        <!-- Grid -->
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                                            <!-- Title -->
                                            <div class="md:col-span-2">
                                            <label for="title" class="block text-sm font-medium mb-1">
                                                Title <span class="text-red-500">*</span>
                                            </label>
                                            <input id="title" type="text"  placeholder="e.g., September Newsletter"
                                                    class="form-input w-full"
                                                    x-model.trim="params.title" />
                                            <p class="text-xs text-gray-500 mt-1">Internal name—recipients won’t see this.</p>
                                            </div>

                                            <!-- From Email -->
                                            <div>
                                            <label for="from_email" class="block text-sm font-medium mb-1">
                                                From Email <span class="text-red-500">*</span>
                                            </label>
                                            <input id="from_email" type="email"  placeholder="you@brand.com"
                                                    class="form-input w-full"
                                                    x-model.trim="params.from_email"
                                                    @input="emailError = !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(params.from_email)" />
                                            <template x-if="emailError">
                                                <p class="text-xs text-red-600 mt-1">Please enter a valid email address.</p>
                                            </template>
                                            <p class="text-xs text-gray-500 mt-1">Use a verified domain for best deliverability.</p>
                                            </div>

                                            <!-- From Name -->
                                            <div>
                                            <label for="from_name" class="block text-sm font-medium mb-1">
                                                From Name <span class="text-red-500">*</span>
                                            </label>
                                            <input id="from_name" type="text"  placeholder="Your Brand"
                                                    class="form-input w-full"
                                                    x-model.trim="params.from_name" />
                                            <p class="text-xs text-gray-500 mt-1">Shown in the recipient’s inbox.</p>
                                            </div>

                                            <!-- Audience (FULL WIDTH) -->
                                            <div class="md:col-span-2" >
                                            <label for="audience" class="block text-sm font-medium mb-1">
                                                Audience <span class="text-red-500">*</span>
                                            </label>

                                            <div class="relative">
                                                <select id="audience" 
                                                        class="form-input w-full appearance-none pr-10"
                                                        x-model="params.audience">
                                                <option value="" disabled selected>Select an audience…</option>
                                                <template x-for="a in audiences" :key="a.id">
                                                    <option :value="a.id" x-text="a.name"></option>
                                                </template>
                                                </select>
                                                
                                            </div>

                                            <p class="text-xs text-gray-500 mt-1">Choose who will receive this campaign.</p>
                                            </div>

                                            <!-- Subject -->
                                            <div class="md:col-span-2">
                                            <label for="subject_line" class="block text-sm font-medium mb-1">
                                                Subject <span class="text-red-500">*</span>
                                            </label>
                                            <textarea id="subject_line" rows="2" 
                                                        placeholder="e.g., ✨ Big news inside!"
                                                        class="form-textarea resize-none min-h-[90px] w-full"
                                                        x-model.trim="params.subject_line"></textarea>
                                            <div class="flex items-center justify-between mt-1 text-xs">
                                                <p class="text-gray-500">Keep it short and compelling (40–60 chars works well).</p>
                                                <span class="text-gray-400" x-text="(params.subject_line?.length || 0) + ' chars'"></span>
                                            </div>
                                            </div>
                                        </div>

                                        <!-- Actions -->
                                        <div class="flex justify-end items-center gap-3 pt-2">
                                            <button type="button" class="btn btn-outline-danger" @click="addCampaignModal = false">Cancel</button>
                                            <button type="submit" class="btn btn-primary"
                                                    x-text="params.id ? 'Update Campaign' : 'Create Campaign'"></button>
                                        </div>
                                        </form>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
    <!-- Filters -->
     <form method="GET" >
        <div class="w-full mt-2">
        <div class="bg-white/70 backdrop-blur rounded-2xl shadow ring-1 ring-gray-200 p-4 sm:p-5">
            <div class="grid grid-cols-1 md:grid-cols-5 gap-3 items-end">
            <!-- Search -->
            <div class="md:col-span-2">
                <label class="block text-xs font-medium text-gray-600 mb-1">Search</label>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-3 items-end">
                    <div class="relative">
                    <input type="text" class="form-input w-full pl-9" placeholder="Search campaigns…" x-model="filters.search" name="search">
                    <div class="absolute ltr:right-[11px] rtl:left-[11px] top-1/2 -translate-y-1/2 peer-focus:text-primary">
                        <svg class="mx-auto" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="11.5" cy="11.5" r="9.5" stroke="currentColor" stroke-width="1.5" opacity="0.5"></circle>
                            <path d="M18.5 18.5L22 22" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path>
                        </svg>
                    </div>
                    </div>
                </div>
            </div>
            <!-- Audience -->
            <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Audience</label>
                <select class="form-input w-full" name="audience" @click.once="loadAudiences()" >
                <option value="">All audiences</option>
                    <template x-for="a in audiences" :key="a.id">
                        <option :value="a.id" x-text="a.name" :selected="a.id === filters.audience"></option>
                    </template>
                
                </select>
            </div>
            <!-- Status -->
            <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Status</label>
                <select class="form-input w-full"  x-model="filters.status" name="status">
                    <option value="" >Any status</option>
                    <template x-for="s in statusOptions" :key="s">
                        <option :value="s" x-text="s" :selected="s === filters.status"></option>
                    </template>
                </select>

            </div>
            <!-- Kind -->
            <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Kind</label>
                <select class="form-input w-full" name="kind" x-model="filters.kind">
                <option value="" disabled selected>Any kind</option>
                <template x-for="k in kindOptions" :key="k">
                    <option :value="k" x-text="k" :selected="k === filters.kind"></option>
                </template>
                </select>
            </div>
            <!-- Actions -->
            <div class="md:col-span-5 flex items-center justify-between  pt-1">
                <div class="flex items-center gap-3 w-full">
                <a href="/campaigns" class="btn btn-outline-danger" >Reset</a>
                <button type="submit" class="btn btn-outline-primary" >Filter</button>
                <button type="button" class="flex-1 btn text-white bg-gradient-to-r from-[#4361ee] to-[#160f6b] !border-0 !shadow-md hover:shadow-lg !rounded-xl px-4 py-2.5 flex items-center gap-2" @click="editCampaign">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    <span>New Campaign</span>
                </button>
                </div>
            </div>
            </div>
        </div>
        </div>
    </form>

    <div class="mt-5 panel p-0 border-0 overflow-hidden">
        <template x-if="isLoading">
        <div class="flex items-center justify-center py-10">
            <svg class="animate-spin h-8 w-8 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10"
                    stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor"
                    d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
            <span class="ml-3 text-gray-600 dark:text-gray-300">Loading campaigns…</span>
        </div>
        </template>
        <template x-if="!isLoading && displayType === 'list'">
            <div class="table-responsive">
                <table class="table-striped table-hover whitespace-nowrap" >
                    <thead>
                      <tr>
                        <th class="!w-10">
                          <input
                            type="checkbox"
                            @change="toggleAll($event)"
                            :checked="allOnPageSelected"
                          />
                        </th>
                        <th  class="cursor-pointer">Campaign</th>
                        <th  class="cursor-pointer">Audience</th>
                        <th>Kind</th>
                        <th>Status</th>
                        <th  class="cursor-pointer">
                          Estimated Recipients
                        </th>
                        <th  class="cursor-pointer">
                          Emails Sent
                        </th>
                        <th class="cursor-pointer">
                          Clicks
                        </th>
                        <th class="cursor-pointer">
                          Click rate
                        </th>
                        <th
                          
                          class="cursor-pointer whitespace-nowrap"
                        >
                          Created AT
                        </th>
                        <th class="!text-center">Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                        <tr x-show="!isLoading && campaignList.length === 0">
                        <td colspan="11" class="text-center text-lg py-6 text-danger dark:text-danger" style="text-align:center">
                            No campaigns found
                        </td>
                        </tr>
                        
                        <template x-for="campaign in campaignList" :key="campaign.id">
                          <tr>
                            <!-- Select -->
                            <td class="!w-10">
                              <input
                                type="checkbox"
                                :checked="selected.has(campaign.id)"
                                @change="$event.target.checked ? selected.add(campaign.id) : selected.delete(campaign.id)"
                              />
                            </td>

                            
                            <!-- Campaign (name + optional audience) -->
                            <td x-text="campaign.title"></td>

                            <td x-text="campaign.audience_name"></td>

                            <!-- Type -->
                            <td>
                                <span class="badge"
                                :class="{
                                  'badge-outline-dark': campaign.kind === 'regular',
                                  'badge-outline-secondary': campaign.kind === 'rss',
                                  'badge-outline-primary': campaign.kind === 'automated',
                                }"
                                x-text="campaign.kind">
                                </span>
                            </td>

                            <!-- Status pill -->
                            <td>
                              <span
                                class="badge shadow-md dark:group-hover:bg-transparent"
                                :class="{
                                  'bg-dark': campaign.status === 'draft',
                                  'bg-secondary': campaign.status === 'scheduled',
                                  'bg-primary': campaign.status === 'sending',
                                  'bg-success': campaign.status === 'completed',
                                  'bg-danger': campaign.status === 'failed'
                                }"
                                x-text="campaign.status"
                              ></span>
                            </td>

                            <!-- Recipients -->
                            <td class="whitespace-nowrap" :class="campaign.estimated_recipients === 0 ? 'text-danger' : 'text-success' " x-text="(campaign.estimated_recipients ?? 0).toLocaleString()"></td>

                            <!-- Open rate -->
                            <td class="whitespace-nowrap" :class="campaign.emails_sent === 0 ? 'text-danger' : 'text-success' "
                                x-text="campaign.emails_sent">
                            </td>

                            <!-- Open rate -->
                            <td class="whitespace-nowrap" :class="campaign.unique_click_count === 0 ? 'text-danger' : 'text-success' "
                                x-text="campaign.unique_click_count ?? 0">
                            </td>


                            <!-- Click rate -->
                            <td class="whitespace-nowrap" :class="campaign.unique_click_count === 0 ? 'text-danger' : 'text-success' "
                                x-text="(((campaign.unique_click_count ?? 0) / (campaign.emails_sent || 1)) * 100).toFixed(1) + '%'">
                            </td>

                            <!-- Created AT -->
                            <td class="whitespace-nowrap"
                                x-text="campaign.created_at ? new Date(campaign.created_at).toLocaleString() : ''">
                            </td>

                            <!-- Actions -->
                            <td class="!text-center">
                              <div class="flex items-center justify-center gap-2">
                                <button x-show="campaign.status !== 'sending' && campaign.status !== 'completed'" type="button" class="btn btn-sm btn-outline-primary" @click="editCampaign(campaign)" >Edit</button>
                                <button x-show="campaign.status === 'sending' " type="button" class="btn btn-sm btn-outline-primary" @click="editCampaign(campaign)" >Pause</button>
                                <a :href="`campaigns/update/?id=${campaign.id}`" class="btn btn-sm btn-outline-secondary" >Preview</a>
                                <button type="button" class="btn btn-sm btn-outline-danger" @click="#">Delete</button>
                              </div>
                            </td>
                          </tr>
                        </template>

                    </tbody>
                </table>
            </div>
        </template>
        
    </div>
    <div x-show="!isLoading && totalPages > 0" class="flex justify-center w-full mt-6">
        <ul class="inline-flex items-center space-x-1 rtl:space-x-reverse">
            <li><button type="button" :disabled="!prevPageUrl" @click="if (currentPage > 1) loadData(currentPage - 1)" class="flex justify-center font-semibold px-3.5 py-2 rounded transition bg-white-light text-dark hover:text-white hover:bg-primary dark:text-white-light dark:bg-[#191e3a] dark:hover:bg-primary">Prev</button></li>
            <template x-for="page in totalPages" :key="page">
                <li><button type="button" @click="loadData(page)" :class="`flex justify-center font-semibold px-3.5 py-2 rounded transition ${currentPage === page ? 'bg-primary text-white dark:text-white-light dark:bg-primary' : 'bg-white-light text-dark hover:text-white hover:bg-primary dark:text-white-light dark:bg-[#191e3a] dark:hover:bg-primary'}`" x-text="page"></button></li>
            </template>
            <li><button type="button" :disabled="!nextPageUrl" @click="if (currentPage < totalPages) loadData(currentPage + 1)"   class="flex justify-center font-semibold px-3.5 py-2 rounded transition bg-white-light text-dark hover:text-white hover:bg-primary dark:text-white-light dark:bg-[#191e3a] dark:hover:bg-primary">Next</button></li>
        </ul>
    </div>
    
</div>


<script>
    document.addEventListener("alpine:init", () => {
        Alpine.data("campaigns", () => ({
            defaultParams: {
                id: null,
                title: '',
                audience: '',
                subject_line: '',
                from_name: '',
                from_email: ''
            },
            filters: {
                'search': '{{ request.GET.search|default:"" }}',
                'status': '{{ request.GET.status|default:"" }}',
                'kind': '{{ request.GET.kind|default:"" }}',
                'audience': '{{ request.GET.audience|default:"" }}',
            },
            audiences: [],
            statusOptions: ['draft','scheduled','sending','completed'],
            kindOptions: ["regular","automated","rss"],
            selected: new Set(),
            displayType: 'list',
            addCampaignModal: false,
            params: {
                id: null,
                title: '',
                audience: '',
                subject_line: '',
                from_name: '',
                from_email: ''
            },
            isLoading: false,
            count: 0,
            currentPage: 1,
            itemsPerPage: 8,
            nextPageUrl: null,
            prevPageUrl: null,
            totalPages: 0,
            filterdContactsList: [],
            searchUser: '',
            campaignList: [],
            contactList: [{
                    id: 1,
                    path: 'profile-35.png',
                    name: 'Alan Green',
                    role: 'Web Developer',
                    email: 'alan@mail.com',
                    location: 'Boston, USA',
                    phone: '+1 202 555 0197',
                    posts: 25,
                    followers: '5K',
                    following: 500,
                },
                {
                    id: 2,
                    path: 'profile-35.png',
                    name: 'Linda Nelson',
                    role: 'Web Designer',
                    email: 'linda@mail.com',
                    location: 'Sydney, Australia',
                    phone: '+1 202 555 0170',
                    posts: 25,
                    followers: '21.5K',
                    following: 350,
                },
                {
                    id: 3,
                    path: 'profile-35.png',
                    name: 'Lila Perry',
                    role: 'UX/UI Designer',
                    email: 'lila@mail.com',
                    location: 'Miami, USA',
                    phone: '+1 202 555 0105',
                    posts: 20,
                    followers: '21.5K',
                    following: 350,
                },
                {
                    id: 4,
                    path: 'profile-35.png',
                    name: 'Andy King',
                    role: 'Project Lead',
                    email: 'andy@mail.com',
                    location: 'Tokyo, Japan',
                    phone: '+1 202 555 0194',
                    posts: 25,
                    followers: '21.5K',
                    following: 300,
                },
                {
                    id: 5,
                    path: 'profile-35.png',
                    name: 'Jesse Cory',
                    role: 'Web Developer',
                    email: 'jesse@mail.com',
                    location: 'Edinburgh, UK',
                    phone: '+1 202 555 0161',
                    posts: 30,
                    followers: '20K',
                    following: 350,
                },
                {
                    id: 6,
                    path: 'profile-35.png',
                    name: 'Xavier',
                    role: 'UX/UI Designer',
                    email: 'xavier@mail.com',
                    location: 'New York, USA',
                    phone: '+1 202 555 0155',
                    posts: 25,
                    followers: '21.5K',
                    following: 350,
                },
                {
                    id: 7,
                    path: 'profile-35.png',
                    name: 'Susan',
                    role: 'Project Manager',
                    email: 'susan@mail.com',
                    location: 'Miami, USA',
                    phone: '+1 202 555 0118',
                    posts: 40,
                    followers: '21.5K',
                    following: 350,
                },
                {
                    id: 8,
                    path: 'profile-35.png',
                    name: 'Raci Lopez',
                    role: 'Web Developer',
                    email: 'traci@mail.com',
                    location: 'Edinburgh, UK',
                    phone: '+1 202 555 0135',
                    posts: 25,
                    followers: '21.5K',
                    following: 350,
                },
                {
                    id: 9,
                    path: 'profile-35.png',
                    name: 'Steven Mendoza',
                    role: 'HR',
                    email: 'sokol@verizon.net',
                    location: 'Monrovia, US',
                    phone: '+1 202 555 0100',
                    posts: 40,
                    followers: '21.8K',
                    following: 300,
                },
                {
                    id: 10,
                    path: 'profile-35.png',
                    name: 'James Cantrell',
                    role: 'Web Developer',
                    email: 'sravani@comcast.net',
                    location: 'Michigan, US',
                    phone: '+1 202 555 0134',
                    posts: 100,
                    followers: '28K',
                    following: 520,
                },
                {
                    id: 11,
                    path: 'profile-35.png',
                    name: 'Reginald Brown',
                    role: 'Web Designer',
                    email: 'drhyde@gmail.com',
                    location: 'Entrimo, Spain',
                    phone: '+1 202 555 0153',
                    posts: 35,
                    followers: '25K',
                    following: 500,
                },
                {
                    id: 12,
                    path: 'profile-35.png',
                    name: 'Stacey Smith',
                    role: 'Chief technology officer',
                    email: 'maikelnai@optonline.net',
                    location: 'Lublin, Poland',
                    phone: '+1 202 555 0115',
                    posts: 21,
                    followers: '5K',
                    following: 200,
                },
            ],

            init() {
                this.searchContacts();
                this.loadData();
                this.loadAudiences();
            },

            loadAudiences(){
                
                if(this.audiences.length > 0){
                    return;
                }
                fetch(`${APP_URL}/audiences/`)
                .then(response => response.json())
                .then(data => {
                    this.audiences = data;
                })
                .catch(error => {
                    console.error('Error fetching audiences:', error);
                });
            },

            searchContacts() {
                this.filterdContactsList = this.contactList.filter((d) => d.name.toLowerCase()
                    .includes(this.searchUser.toLowerCase()));
            },
            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            },
            async loadData(page = null){
                try {
                    this.isLoading = true;
                    //await this.sleep(2000); // Simulate loading delay
                    let baseUrl = `${APP_URL}/campaigns/`;
                    let queryString = new URLSearchParams(window.location.search);
                    if (page) {
                        queryString.set('page', page);
                    }
                    this.currentPage = parseInt(queryString.get('page')) || 1;
                    let url = baseUrl + '?' + queryString.toString();
                    let response = await fetch(url);
                    let data = await response.json();
                    this.count = data.count;
                    this.nextPageUrl = data.next;
                    this.prevPageUrl = data.previous;
                    this.isLoading = false;
                    this.campaignList = data.results;
                    this.totalPages = Math.ceil(this.count / this.itemsPerPage);
                    console.log(this.totalPages);
                    window.history.pushState({}, '', `?${queryString.toString()}`);
                } catch (error) {
                    console.error('Error loading data:', error);
                }
            },

            editCampaign(campaign) {
                if(this.audiences.length === 0){
                    this.loadAudiences();
                }
                this.params = this.defaultParams;
                if (campaign) {
                    this.params = JSON.parse(JSON.stringify(campaign));
                    console.log(this.params);
                }

                this.addCampaignModal = true;
            },

            async saveUser() {
                if (!this.params.title) {
                    this.showMessage('Title is required.', 'error');
                    return true;
                }
                if (!this.params.from_email) {
                    this.showMessage('From Email is required.', 'error');
                    return true;
                }
                if (!this.params.from_name) {
                    this.showMessage('From Name is required.', 'error');
                    return true;
                }
                if (!this.params.subject_line) {
                    this.showMessage('Subject is required.', 'error');
                    return true;
                }
                if (!this.params.audience) {
                    this.showMessage('Audience is required.', 'error');
                    return true;
                }

                if (this.params.id) {
                    //update user
                    let campaign = this.campaignList.find((d) => d.id === this.params.id);
                    campaign.title = this.params.title;
                    campaign.from_email = this.params.from_email;
                    campaign.from_name = this.params.from_name;
                    campaign.subject_line = this.params.subject_line;
                    campaign.audience = this.params.audience;
                    try{
                        let response = await fetch(`${APP_URL}/campaigns/${campaign.id}/`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCookie("csrftoken"),
                        },
                        body: JSON.stringify(this.params)
                    });
                        let data = await response.json();
                        console.log(data);

                    }catch(e){
                        console.error(e.message || "Unexpected error!");

                    }finally{
                        console.log('done');
                    }
                } else {
                    //add user
                    try{
                        let response = await fetch(`${APP_URL}/campaigns/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            "X-CSRFToken": getCookie("csrftoken"),
                        },
                        body: JSON.stringify(this.params)
                    });
                        let data = await response.json();
                        console.log(data);
                        if (data?.id) {
                            window.location.href = `/campaigns/update/?id=${data.id}`;
                        }

                    }catch(e){
                        console.error(e.message || "Unexpected error!");

                    }finally{
                        console.log('done');
                       
                    }
                    let maxUserId = this.contactList.length ? this.contactList.reduce((max,
                            character) => (character.id > max ? character.id : max), this
                        .contactList[0].id) : 0;

                    let campaign = {
                        id: 50,
                        title: this.params.title,
                        from_email: this.params.from_email,
                        from_name: this.params.from_name,
                        subject_line: this.params.subject_line,
                        audience: this.params.audience,
                    };
                    this.campaignList.splice(0, 0, campaign);
                    this.loadData();
                }

                this.showMessage('Campaign has been saved successfully.');
                this.addCampaignModal = false;
            },

            deleteUser(user) {
                this.contactList = this.contactList.filter((d) => d.id != user.id);
                this.searchContacts();
                this.showMessage('User has been deleted successfully.');
            },
            
            showMessage(msg = '', type = 'success') {
                const toast = window.Swal.mixin({
                    toast: true,
                    position: 'top',
                    showConfirmButton: false,
                    timer: 3000,
                });
                toast.fire({
                    icon: type,
                    title: msg,
                    padding: '10px 20px',
                });
            },
        }));
    });
    
</script>

{% endblock %}